<HTML><HEAD><TITLE>网络7层管理和过滤的领导者</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK rel=stylesheet type=text/css href="/ext/resources/css/ext-all.css">
<LINK rel=stylesheet type=text/css href="/ext/resources/css/xtheme-default.css">
<SCRIPT type=text/javascript src="/ext/adapter/ext/ext-base.js"></SCRIPT>
<SCRIPT type=text/javascript  src="/ext/ext-all.js"></SCRIPT>
<SCRIPT type=text/javascript  src="/msa/publicjs/pubstyle.js"></SCRIPT>
<link rel="stylesheet" type="text/css" href="/msa/publiccss/pubcss.css">
<link rel="stylesheet" href="/msa/publiccss/css.css" type="text/css">
<link href="/Content/IconCls.css" rel="stylesheet" type="text/css" />
<STYLE type=text/css>
HTML {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
BODY {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
P {
	MARGIN: 5px
}
.STYLE1 {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
}
</STYLE>

<SCRIPT type=text/javascript>
	//id 表名 类型

    Ext.BLANK_IMAGE_URL = '/msa/extjs/resources/images/default/s.gif';
		var pagesize;
		var havesearch;
		var addwin;
		var store;
		pagesize=50;
		havesearch=0;
		
	
    Ext.onReady(function(){
	  		Ext.QuickTips.init();
				var detailEl;
				var myMask = new Ext.LoadMask(Ext.getBody(),
				    {
				        	msg:"Please wait..."
				    });
				myMask.show();
    
     var xtzystore = new Ext.data.SimpleStore({
        url:'/msa/main.xp?Fun=ltsysregist',
        fields: [
           {name: 'company'},
           {name: 'price' },
           {name: 'pctChange'}
        ]
    });
    
    xtzystore.load();
    
    var xtzystoreupdate = new Ext.data.SimpleStore({
        url:'/msa/main.xp?Fun=updatereportlist',
        fields: [
            {name: 'company'},
            {name: 'price' }
        ]
    });

    xtzystoreupdate.load();
    
    // create the Grid
    var xtzygridupdate = new Ext.grid.GridPanel({
        store: xtzystoreupdate,
        columns: [
            {header: "升级包版本", width: 300, sortable: true,   dataIndex: 'price'}
        ],
        stripeRows: true,
        width:500,
        height:450,
		    collapsible:false,
		    loadMask:{msg:'正在加载数据，请稍侯……'}
    });
    
     xtzygridupdate.addListener('rowclick', rightClickFn);
     function rightClickFn(client, rowIndex, e) {
		                detailEl=rowIndex;
		                var record = xtzygridupdate.getStore().getAt(detailEl);
		                detailEl=record.get("price");
		                open("/updatereport/" + detailEl + "/info.htm");
		                //rightClick.showAt(e.getXY()); 
     } 
    
    function clickHandlerUpdate(item){
    	 Ext.MessageBox.confirm('Confirm', '您确认要升级吗?', showsysupdate);
		}
		function clickHandlerUrl(item){
    	 Ext.MessageBox.confirm('Confirm', '您确认要提交吗?', showsysuploadurl);
		}
    function clickHandler(item){
    	                 	var mylistwin =new  Ext.Window(
							          {
							                    title: '系统已升级列表',
							                    height: 350,
							                    width: 500,
							                    margins:'0 5 0 0',
							                    items:[xtzygridupdate]
							          });
							         mylistwin.show(); 
		}
		
		
		
    var xtzygrid = new Ext.grid.GridPanel({
        store: xtzystore,
        columns: [
            {id:'company',header: "项目", width: 195, sortable: true, dataIndex: 'company'},
            {header: "数值", width: 250, sortable: true,   dataIndex: 'price'},
            {header: "描述", width: 280, sortable: true,  dataIndex: 'pctChange'}
        ],
        bodyStyle:'width:100%;height:' + 600,
        iconCls: 'icon-grid',
        tbar:[{text:"在线升级",
        			pressed: true,
	            icon: '/msa/images/menu-show.gif',
	            enableToggle:true,
	            cls: 'x-btn-text-icon details',
        			handler: clickHandlerUpdate},
       		'-',{text:"提交未识别URL",
        			pressed: true,
	            icon: '/msa/images/menu-show.gif',
	            enableToggle:true,
	            cls: 'x-btn-text-icon details',
        			handler: clickHandlerUrl},
				        '-',{text:"查看升级历史记录",
        			pressed: true,
	            icon: '/msa/images/menu-show.gif',
	            enableToggle:true,
	            cls: 'x-btn-text-icon details',
        			handler: clickHandler}
       	],
        stripeRows: true,
        autoWidth : true,
        frame:false,
		    collapsible:false,
		    loadMask:{msg:'正在加载数据，请稍侯……'},
		    draggable:false,
		    enableDragDrop: false,
		    renderTo: Ext.getBody()
    });
    
    function showsysupdate(btn){
					        if(btn=='yes'){
					         Ext.Ajax.request({
						                      method : 'POST', 
						                      url:'/msa/main.xp', 
					                        success: function(response, options) { 
					    													var runner;
					                               Ext.MessageBox.show({
																	           msg: '运行升级程序',
																	           progressText: '正在运行升级程序....',
																	           width:450,
																	           wait:true,
																	           progress:true,
																	           waitConfig: {interval:1000},
																	           icon:'ext-mb-download'
																	      }); 
																	      var task = {
																						run: function(){
																						   Ext.Ajax.request({
																	                      method : 'POST', 
																	                      url:'/msa/main.xp', 
																                        success: function(response, options) { 
																    											var retxt=response.responseText;
																    											//alert(retxt);
																    											if(retxt.substring(0,1)=="0" ){
																    												if(retxt.substring(1,2)=="*"){
																		    												runner.stopAll();   
																		                            Ext.MessageBox.hide();   
																		                         	  Ext.MessageBox.alert('提示','没有新的升级包！'); 
																    											  }else {
																		    												runner.stopAll();   
																		                            Ext.MessageBox.hide();   
																		                         	  Ext.MessageBox.alert('提示','运行升级程序结束！10秒后系统将会重新启动。'); 
																		                         }
																    											}else{
																    											  Ext.MessageBox.updateProgress(0, retxt.substring(1,retxt.length) );	
																    											}		
																                        }, 
																                        failure : function() {  
																                          runner.stopAll();   
																                          Ext.MessageBox.hide();   
																                         	Ext.MessageBox.alert('提示','运行升级程序失败！'); 
											                                  },
																                       params:{
																                            Fun:'ltsysregistok',
																														begin:'0' 
											 					                        } 
																                });
																						},
																						interval: 5000 // 每30秒一周期
																				};
																				runner = new Ext.util.TaskRunner();
																				runner.start(task);
					                        },
					                        failure : function() {    
					                          Ext.MessageBox.hide();  
					                         	Ext.MessageBox.alert('提示','运行升级程序失败！'); 
                                  },
 					                        params:{
 					                            Fun:'ltsysregistok',
																			begin:'1' 
 					                        } 
												});
						    
					        }
					        
					};
     function showsysuploadurl(btn){
					        if(btn=='yes'){
					          
						         Ext.Ajax.request({
						                      method : 'POST', 
						                      url:'/msa/main.xp', 
					                        success: function(response, options) { 
					    													Ext.MessageBox.alert('提示','谢谢您正在提交的未识别url,我们将会在30个工作日完成全部更新....');
					                        },
 					                        params:{
 					                            Fun:'nasUploadUrl'
 					                        } 
												});
					        }
					};
					
		myMask.hide();
});
	</SCRIPT>
</HEAD>
<body oncontextmenu="return false" bgcolor="#F0f0f0" topmargin=0 leftmargin=0 style="SCROLLBAR-FACE-COLOR: #f0f0f0;  overflow-x:hidden;  OVERFLOW: scroll; SCROLLBAR-SHADOW-COLOR: #f0f0f0; SCROLLBAR-3DLIGHT-COLOR: #f0f0f0; SCROLLBAR-ARROW-COLOR: #f0f0f0; SCROLLBAR-DARKSHADOW-COLOR: #cccccc;" >
</BODY>
</HTML>

