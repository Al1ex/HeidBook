<HTML><HEAD><TITLE>网络7层管理和过滤的领导者</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK rel=stylesheet type=text/css href="/ext/resources/css/ext-all.css">
<LINK rel=stylesheet type=text/css href="/ext/resources/css/xtheme-default.css">
<SCRIPT type=text/javascript src="/ext/adapter/ext/ext-base.js"></SCRIPT>
<SCRIPT type=text/javascript  src="/ext/ext-all.js"></SCRIPT>
<SCRIPT type=text/javascript  src="/msa/publicjs/pubstyle.js"></SCRIPT>
<link rel="stylesheet" type="text/css" href="/msa/publiccss/pubcss.css">
<link rel="stylesheet" href="/msa/publiccss/css.css" type="text/css">
<STYLE type=text/css>HTML {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
BODY {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
P {
	MARGIN: 5px
}
</STYLE>
<SCRIPT LANGUAGE="JavaScript">
function update() {
	  var ethdevlist = new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0); 
    var ethdevMlist = new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0); 
		
		var myLanchk1,myLanchk2;
	  var regIP=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;		
	  if(listform.Lanchk1.checked==true){
	  	myLanchk1=1;
	  	if(ethdevlist[parseInt(listform.outLanA.value)]==1){
	  		Ext.MessageBox.alert('提示','网口'+ listform.outLanA.value + '有重复配置！');
	  		return false;
	  	}else{
	  		ethdevlist[parseInt(listform.outLanA.value)]=1;
	  	}
	  	
		  var myoutIPA=listform.outIPA.value;
			var myoutmaskA=listform.outmaskA.value;
			var outGWA=listform.outGWA.value;
			var outLanAType=listform.outLanAType.value;
			
	  	if(listform.typeA.value==0){
			  if(myoutIPA==""){
			  	alert("对不起，外网口IP不能为空！");
			  	return false;
			  }else if(myinIP!=""){
				  var IP_flag=false;
				  if(regIP.test(myoutIPA)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if(!IP_flag){
					  alert('对不起，IP地址格式错误！');
						listform.outIPA.focus();
						listform.outIPA.select();
					  return false;
					}
				}
			  if(myoutmaskA==""){
			  	alert("对不起，外网口子网掩码不能为空！");
			  	return false;
			  }else if(myoutmaskA!=""){
				  var IP_flag=false;
				  if(regIP.test(myoutmaskA)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if (!IP_flag){
					  alert('对不起，外网口子网掩码格式错误！');
						listform.outmaskA.focus();
						listform.outmaskA.select();
					  return false;
					}
				}
				
				if(outGWA==""){
			  	alert("对不起，网关地址不能为空！");
			  	return false;
			  }else if(outGWA!=""){
				  var IP_flag=false;
				  if(regIP.test(outGWA)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if (!IP_flag){
					  alert('对不起，网关地址格式错误！');
						listform.outGWA.focus();
						listform.outGWA.select();
					  return false;
					}
				}
				
			}else{
				myoutIPA="0.0.0.0";
				myoutmaskA="0.0.0.0";
				outGWA="0.0.0.0";
				outLanAType="0"
			}
	  }else{myLanchk1=0;}
	  if(listform.Lanchk2.checked==true){
	  	myLanchk2=1;
	  	if(ethdevlist[parseInt(listform.outLanB.value)]==1){
	  		Ext.MessageBox.alert('提示','网口'+ listform.outLanB.value + '有重复配置！');
	  		return false;
	  	}else{
	  		ethdevlist[parseInt(listform.outLanB.value)]=1;
	  	}
	  	var myoutIPB=listform.outIPB.value;
			var myoutmaskB=listform.outmaskB.value;
			var outGWB=listform.outGWB.value;
			var outLanBType=listform.outLanBType.value;
			
			if(listform.typeB.value==0){
			  if(myoutIPB==""){
			  	alert("对不起，外网口IP不能为空！");
			  	return false;
			  }else if(myoutIPB!=""){
				  var IP_flag=false;
				  if(regIP.test(myoutIPB)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if (!IP_flag){
					  alert('对不起，IP地址格式错误！');
						listform.outIPB.focus();
						listform.outIPB.select();
					  return false;
					}
				}
			  if(myoutmaskB==""){
			  	alert("对不起，外网口子网掩码不能为空！");
			  	return false;
			  }else if(myoutmaskB!=""){
				  var IP_flag=false;
				  if(regIP.test(myoutmaskB)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if (!IP_flag){
					  alert('对不起，外网口子网掩码格式错误！');
						listform.outmaskB.focus();
						listform.outmaskB.select();
					  return false;
					}
				}
				if(outGWB==""){
			  	alert("对不起，网关地址不能为空！");
			  	return false;
			  }else if(outGWB!=""){
				  var IP_flag=false;
				  if(regIP.test(outGWB)){
						IP_flag = true;
					}else{
						IP_flag = false;
					}
					if (!IP_flag){
					  alert('对不起，网关地址格式错误！');
						listform.outGWB.focus();
						listform.outGWB.select();
					  return false;
					}
				}
			}else{
				myoutIPB="0.0.0.0";
				myoutmaskB="0.0.0.0";
				outGWB="0.0.0.0";
				outLanBType="0";
			}
	  }else{myLanchk2=0;}	  
	  
  	if(ethdevlist[parseInt(listform.inLan.value)]==1){
  		Ext.MessageBox.alert('提示','网口'+ listform.inLan.value + '有重复配置！');
  		return false;
  	}else{
  		ethdevlist[parseInt(listform.inLan.value)]=1;
  	}
  		var myinIP=listform.inIP.value;
  		var myinmask=listform.inmask.value;
		  if(myinIP==""){
		  	alert("对不起，内网口IP不能为空！");
		  	return false;
		  }else if(myinIP!=""){
			  var IP_flag=false;
			  if(regIP.test(myinIP)){
					IP_flag = true;
				}else{
					IP_flag = false;
				}
				if (!IP_flag){
				  alert('对不起，IP地址格式错误！');
					listform.inIP.focus();
					listform.inIP.select();
				  return false;
				}
			}
		  if(myinmask==""){
		  	alert("对不起，管理子网掩码不能为空！");
		  	return false;
		  }else if(myinmask!=""){
			  var IP_flag=false;
			  if(regIP.test(myinmask)){
					IP_flag = true;
				}else{
					IP_flag = false;
				}
				if (!IP_flag){
				  alert('对不起，子网掩码格式错误！');
					listform.inmask.focus();
					listform.inmask.select();
				  return false;
				}
			}
			
    Ext.Ajax.request({
		    method : 'POST', 
		    url:'/msa/main.xp', 
		    success: function() { 
						Ext.MessageBox.alert('提示','边缘防火墙设置成功！'); 
		    },
		    failure: function() {     
		     	Ext.MessageBox.alert('提示','边缘防火墙设置失败！'); 
		    },
		    params:{
		      Fun:'ltsysnetconfok',actiontype:5,
		      Lanchk1:myLanchk1,
		      Lanchk2:myLanchk2,
		      outLanA:listform.outLanA.value,
		      outLanB:listform.outLanB.value,
		      inLan:listform.inLan.value,
		      outmaskA:listform.outmaskA.value,
		      outmaskB:listform.outmaskB.value,
		      inmask:listform.inmask.value,
		      outIPA:listform.outIPA.value,
		      outIPB:listform.outIPB.value,
		      inIP:listform.inIP.value,
		      typeA:listform.typeA.value,
		      typeB:listform.typeB.value,
		      outUserA:listform.outUserA.value,
		      outUserB:listform.outUserB.value,
		      outPassA:listform.outPassA.value,
		      outPassB:listform.outPassB.value,
		      flowA:listform.flowA.value,
		      flowB:listform.flowB.value,
		      outGWA:listform.outGWA.value,
		      outLanAType:listform.outLanAType.value,
		      outGWB:listform.outGWB.value,
		      outLanBType:listform.outLanBType.value,
		      benlenceT:listform.benlenceT.value,
		      DefaultLink:listform.DefaultLink.value
		    } 
		});
}
function tabfun(){
	if(listform.Lanchk1.checked==true){
		document.getElementById("outIPA").disabled=false;
		document.getElementById("outLanA").disabled=false;
		document.getElementById("outmaskA").disabled=false;
		document.getElementById("outGWA").disabled=false;
		document.getElementById("typeA").disabled=false;
		if(document.getElementById("typeA").value=="0"){
		   document.getElementById("div2").style.display="none";//
		   document.getElementById("div1").style.display="";//
		   document.getElementById("outUserA").disabled=true;//
		   document.getElementById("outPassA").disabled=true;//
		}else{    
		   document.getElementById("div2").style.display="";//
		   document.getElementById("div1").style.display="none";//
		   document.getElementById("outUserA").disabled=false;//
		   document.getElementById("outPassA").disabled=false;//
	  }
	}else{
		document.getElementById("outIPA").disabled=true;
		document.getElementById("outLanA").disabled=true;
		document.getElementById("outmaskA").disabled=true;
		document.getElementById("typeA").disabled=true;
	  document.getElementById("outUserA").disabled=true;//
		document.getElementById("outPassA").disabled=true;//
		document.getElementById("outGWA").disabled=true;
	}
	if(listform.Lanchk2.checked==true){
		document.getElementById("outIPB").disabled=false;
		document.getElementById("outLanB").disabled=false;
		document.getElementById("outmaskB").disabled=false;
		document.getElementById("outGWB").disabled=false;
		document.getElementById("typeB").disabled=false;
		if(document.getElementById("typeB").value=="0"){
		   document.getElementById("div4").style.display="none";//
		   document.getElementById("div3").style.display="";//
		   document.getElementById("outUserB").disabled=true;//
		   document.getElementById("outPassB").disabled=true;//
		}else{    
		   document.getElementById("div4").style.display="";//
		   document.getElementById("div3").style.display="none";//
		   document.getElementById("outUserB").disabled=false;//
		   document.getElementById("outPassB").disabled=false;//
	  }
	}else{
		document.getElementById("outIPB").disabled=true;
		document.getElementById("outLanB").disabled=true;
		document.getElementById("outmaskB").disabled=true;
		document.getElementById("typeB").disabled=true;
	  document.getElementById("outUserB").disabled=true;//
		document.getElementById("outPassB").disabled=true;//
		document.getElementById("outGWB").disabled=true;
	}
	
	if(listform.Lanchk2.checked==true && listform.Lanchk1.checked==true){//此时才会启动链路负载均衡
		document.getElementById("benlenceT0").disabled=false;
		document.getElementById("benlenceT1").disabled=false;
		document.getElementById("flowA").disabled=false;
		document.getElementById("flowB").disabled=false;
	  document.getElementById("DefaultLink").disabled=false;//		 
	}else{
		document.getElementById("benlenceT0").disabled=true;
		document.getElementById("benlenceT1").disabled=true;
		document.getElementById("flowA").disabled=true;
		document.getElementById("flowB").disabled=true;
	  document.getElementById("DefaultLink").disabled=true;//		
	}
	
	if("[$benlenceT$]"=="0"){
		document.getElementById("benlenceT0").checked=true;
	}else{
		document.getElementById("benlenceT1").checked=true;
	}
	
}
function tabfun1(){
	if(document.getElementById("equalAchk").checked==true){
  	 document.getElementById("flowA").disabled=false;
  }else{
  	 document.getElementById("flowA").disabled=true;
  }
}
function tabfun2(){
	if(document.getElementById("equalBchk").checked==true){
  	 document.getElementById("flowB").disabled=false;
  }else{
  	 document.getElementById("flowB").disabled=true;
  }
}
</SCRIPT>
<SCRIPT type="text/JavaScript">
    Ext.BLANK_IMAGE_URL = '/msa/extjs/resources/images/default/s.gif';
		Ext.onReady(function(){
	  		Ext.QuickTips.init();
				var myMask = new Ext.LoadMask(Ext.getBody(),{
				    msg:"Please wait..."
				});
				myMask.show(); 
				document.getElementById("north").style.display="";
		    new Ext.Viewport({
						layout: 'border',
						items: [{
		          region:'center',
		          contentEl: 'north',
		          autoScroll:true,
		          split:true,
		          height: 768,
		          minSize: 100,
		          maxSize: 300,
		          collapsible: false,
		          //title:'配置网络参数:边缘防火墙<font color="red">(不可配置空网口或未启用网口)</font>',
		          margins:'0 0 0 0',
		          tbar:['->',{
		            	icon: '/msa/images/warning.gif',
									enableToggle:true,
									cls: 'x-btn-text-icon details',
		            	tooltip:{text:'<b>保存配置</b>'},
		            	text:'保存配置',
		            	iconCls:'connect',
		            	handler:function(){
		            		Ext.MessageBox.confirm('提示','您是否确定要保存当前的部署',function(button,text){
		            			if(button == 'yes'){
														update();
											}
									  })
								  }
		            },
								{
									icon: '/msa/images/warning.gif',
									enableToggle:true,
									cls: 'x-btn-text-icon details',
		            	tooltip:{text:'<b>应用该部署方式</b>'},
		            	text:'应用网口',
		            	iconCls:'connect',
		            	handler:function(){
		            		Ext.MessageBox.confirm('提示','您是否确定要应用当前的部署',function(button,text){
										   if (button == 'yes'){
											   	Ext.MessageBox.show({
																	msg: '边缘防火墙应用中，请稍等...',
																	progressText: 'waitting...',
																	width:300,
																	wait:true,
																	waitConfig: {interval:500},
																	icon:'ext-mb-download'
													});
					            		Ext.Ajax.request
													({
														url:'/msa/main.xp',
														params:{Fun:'msaApplyAction',deflag:'1'},
														success:function(response,options){
																Ext.MessageBox.confirm('提示','网桥部署成功，您是否要到'+listform.inIP.value+'/msa下应用新配置!',function(button,text){
																		   if (button == 'yes'){
																		   	window.open("https://"+listform.inIP.value+"/msa", "page1", "width="+ screen.width + ",height=" + screen.height + ",top=0,left=0,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,location=yes,status=yes,fullscreen=yes");
																		   }												  	
																})
														},
														failure:function(){
				                           Ext.MessageBox.alert('提示','网口应用失败!');
				                    }
													});
												}
										})
		              }
	              }
							]
		         }],
		        renderTo: Ext.getBody()
		    });
		    myMask.hide();
    });
</SCRIPT>
</head>
<body bgcolor="#f0f0f0" text="#000000" topmargin="2"  style="SCROLLBAR-FACE-COLOR: #f0f0f0;  overflow-x:hidden;  OVERFLOW: scroll; SCROLLBAR-SHADOW-COLOR: #f0f0f0; SCROLLBAR-3DLIGHT-COLOR: #f0f0f0; SCROLLBAR-ARROW-COLOR: #f0f0f0; SCROLLBAR-DARKSHADOW-COLOR: #cccccc;" onLoad="tabfun()">
<DIV id=north style="display:none">
<form name="listform" action="/msa/main.xp" method="POST">
<input type="hidden" id="nownum" value="[$nownum$]">
<table width="100%" border="0" height="100%" bgcolor="#f0f0f0" align="center">
  <tr> 
    <td valign="top"> 
      <table width="100%" border="0" align="center">
	     	<tr>
		     	<td width="43%">
		         <fieldset style="width:786;height:30;border:2px groove" align=center>
		          <legend><input type="checkbox" name="Lanchk1" value="0" class="inputchk"  [$Lanchk1chk$] onClick="tabfun()">启动链路一</legend> 
				      <table width="100%" border="0" align="center" cellpadding="1">
				        <tr> 
				          <td width="30%"> 网口
				          <select id="outLanA" name="outLanA" class=inputsel>   
						          [$begintable Lanlist1$]         
						          <option value="[$vlanid$]" [$selvid$] >eth[$vlanid$]</option>   
						          [$endtable$]
					    		</select>
					    		<select id="outLanAType" name="outLanAType" class=inputsel>         
						          <option value="0" [$Aselty0$] >电信链路</option>  
						          <option value="1" [$Aselty1$] >联通链路</option> 
						          <option value="2" [$Aselty2$] >教育网链路</option> 
						          <option value="3" [$Aselty3$] >移动链路</option> 
						          <option value="4" [$Aselty4$] >其他链路</option>  
					       </select>
			    		  </td>
				          <td width="80%">
				          	<input type=hidden id="typeA" name="typeA" class=inputsel  value="0" onChange="tabfun()">   
				          	<div id="div1" style="display:">网口IP&nbsp;&nbsp; 
					            <input type="text" name="outIPA" value="[$outIPA$]"  class="input" size="13" >子网掩码 
				              <input type="text" name="outmaskA" value="[$outmaskA$]"  class="input" size="13" >
				              网关地址<input type="text" name="outGWA" value="[$outGWA$]"  class="input" size="13" >
			             	</div>
						  			<div id="div2" style="display:none">用户名称 
					            <input type="text" name="outUserA" value="[$outUserA$]"  class="input" size="13" >用户密码 
				              <input type="text" name="outPassA" value="[$outPassA$]"  class="input"  size="13" >
			             </div>
			            </td>
			          </tr>
								
		          </table>
				  	 </fieldset>
		 	  	</td>
			  </tr>
			  <tr>
		     	<td width="57%">
		         <fieldset style="width:786;height:30;border:2px groove" align=center>
		          <legend><input type="checkbox" name="Lanchk2" value="0" class="inputchk" [$Lanchk2chk$] onClick="tabfun()">启动链路二</legend> 
				      <table width="100%" border="0" align="center" cellpadding="1">
				        <tr> 
				          <td width="30%">网口
				          <select id="outLanB" name="outLanB" class=inputsel>   
						          [$begintable Lanlist2$]         
						          <option value="[$vlanid$]" [$selvid$] >eth[$vlanid$]</option>   
						          [$endtable$]
					      </select>
					       <select id="outLanBType" name="outLanBType" class=inputsel>         
						          <option value="0" [$Bselty0$] >电信链路</option>  
						          <option value="1" [$Bselty1$] >联通链路</option> 
						          <option value="2" [$Bselty2$] >教育网链路</option> 
						          <option value="3" [$Bselty3$] >移动链路</option> 
						          <option value="4" [$Bselty4$] >其他链路</option>  
					       </select>
					      </td>
				          <td width="70%">
				          	<input type=hidden id="typeB" name="typeB" class=inputsel  value="0" onChange="tabfun()">   
				          	<div id="div3" style="display:">网口IP&nbsp;&nbsp; 
				            <input type="text" name="outIPB" value="[$outIPB$]"  class="input" size="13" >子网掩码 
			              <input type="text" name="outmaskB" value="[$outmaskB$]"  class="input" size="13" >
			              网关地址<input type="text" name="outGWB" value="[$outGWB$]"  class="input" size="13" >
			              </div>
						  <div id="div4" style="display:none">用户名称 
				            <input type="text" name="outUserB" value="[$outUserB$]"  class="input"  size="13" >				          用户密码 
			              <input type="text" name="outPassB" value="[$outPassB$]"  class="input"  size="13" ></div>			              </td>
			            </tr>
						
				      </table>
			  	  </fieldset>
		 	    </td>
		  </tr>
		  
		  
		  <tr>
		     	<td width="57%">
		         <fieldset style="width:786;height:30;border:2px groove" align=center>
		          <legend>双链路负载均衡设置</legend> 
				      <table width="100%" border="0" align="center" cellpadding="1">
				        <tr> 
				          <td width="30%"><input type="radio" id="benlenceT0" name="benlenceT" value="0">按流量比重负载均衡
					      </td>
				          <td width="70%">
				          链路一流量权重:<input type="text" id="flowA" name="flowA" value="[$flowA$]"  class="input" size="5" maxlength="3" onKeyUp="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')">%
				          <br>
				          链路二流量权重:<input type="text" id="flowB" name="flowB" value="[$flowB$]"  class="input" size="5" maxlength="3" onKeyUp="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')">%
				          </td>
			            </tr>
						    <tr> 
				          <td width="30%"><input type="radio" id="benlenceT1" name="benlenceT" value="1">按链路接入运行商均衡
					      </td>
				          <td width="70%">
				          	默认的出口链路： 
				          <select id="DefaultLink" name="DefaultLink" class=inputsel>         
						          <option value="0" [$deflnk0$] >出口链路一</option>  
						          <option value="1" [$deflnk1$] >出口链路二</option> 
					       </select>
				          	</td>
			            </tr>
				      </table>
			  	  </fieldset>
		 	    </td>
		  </tr>
		  
		  </table>
		  
     	<table width="100%" border="0" align="center">
	     	<tr>
		     	<td>
		         <fieldset style="width:786" height:30;border:2px groove" align=center>
		          <legend>内网口</legend> 
		          <table width="100%" border="0" align="center">
					        <tr> 
					          <td width="20%"> 
					          网口<select id="inLan" name="inLan" class=inputsel>   
						          [$begintable Lanlist3$]         
						          <option value="[$vlanid$]" [$selvid$] >eth[$vlanid$]</option>   
						          [$endtable$]
							    </select>					          </td>
					          <td width="80%">网口IP&nbsp;&nbsp;
				              <input type="text" name="inIP" value="[$inIP$]"  class="input" size="13" >子网掩码 
				              <input type="text" name="inmask" value="[$inmask$]"  class="input" size="13" ></td>
				            </tr>
			  	 </table>
				  </fieldset>
			  </td>
		  </tr>
			</table>

		  
     	<table width="100%" border="0" align="center">
	     	<tr>
		     	<td>
		         <fieldset style="width:786" height:30;border:2px groove" align=center>
		          <legend>图例</legend> 
		          <table width="100%" border="0" align="center">
					        <tr> 
					          <td width="25%"> 
					          <img src="/msa/images/connect2tmp.jpg" width="768">	
					          </td>
					        </tr>
			  	 		</table>
				  	 </fieldset>
			  	</td>
		  	</tr>
			</table>
    </td>
  </tr>
  
</table>
</form>
</DIV>
</body>
</html>
