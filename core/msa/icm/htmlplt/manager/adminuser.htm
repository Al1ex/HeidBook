<html>
<head>
<title>系统用户</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="/icm/publiccss/pubcss.css" type="text/css">
<SCRIPT LANGUAGE="JavaScript">
function xxxxfun(xName){
	listform.logname.value=xName;
	listform.Fun.value="icmAdminUserList";
	listform.submit();
}
function addlistfun() {
	if(listform.logname.value=="" ){
		alert("用户名不能为空!");
		listform.logname.focus();
		listform.logname.select();
		return;
	}
	if(listform.pass.value=="" ){
		alert("密码不能为空!");
		listform.pass.focus();
		listform.pass.select();
		return;
	}
	if(listform.pass.value!=listform.repass.value ){
		alert("密码不一致!");
		listform.pass.value="";
		listform.repass.value="";
		listform.pass.focus();
		return;
	}
	
	var mypass=listform.pass.value;
	for(var i=0;i<mypass.length;i++)
     {
       var myChar= mypass.toLowerCase().charAt(i);
       var myLenth=mypass.replace(/[^\x00-\xff]/g,'**').length;	
       if((!(myChar>='0' && myChar<='9')) && (!(myChar>='a' && myChar<='z')))
       { 
			  alert("对不起，密码不安全！");
				listform.pass.focus();
				listform.pass.select();
      	return;
       }
       else if((myLenth>=0)&&(myLenth<8))
       { 
			  alert("对不起，密码不安全！");
				listform.pass.focus();
				listform.pass.select();
      	return;
       }
     }
	var Pass_flag=false;
	var reg=/^(?=.*[0-9].*)(?=.*[a-zA-Z].*).{8,}$/;//必须包含数字和字母
	if(reg.test(mypass)){
		Pass_flag = true;
		}else{
		Pass_flag = false;
		}
		if (!Pass_flag){
		  alert("对不起，密码不安全！");
			listform.pass.focus();
			listform.pass.select();
		  return false;
		}
		
	if(listform.bindip.value==""){
		alert("Ip不能为空!");
		listform.bindip.focus();
		listform.bindip.select();
		return;
	}
	var myip=listform.bindip.value;
  var regIP=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
  var IP_flag=false;
  if(regIP.test(myip)){
	IP_flag = true;
	}else{
	IP_flag = false;
	}
	if (!IP_flag){
	  alert("对不起，ip地址格式错误！");
		listform.bindip.focus();
		listform.bindip.select();
	  return false;
	}
	listform.submit();
}

function dellistfun() {
	if(listform.logname.value=="admin"){
		alert("你不能删除admin用户");
		return;
	}
	listform.actiontype.value="2";
	listform.submit();

}

function  updatelistfun() {
	if(listform.logname.value=="admin"){
		alert("你不能修改admin用户");
		return;
	}
	listform.actiontype.value="3";
	listform.submit();
}

function  updateipfun() { 
	if(listform.bindip.value==""){
		alert("Ip不能为空!");
		listform.bindip.focus();
		listform.bindip.select();
		return;
	}
	var myip=listform.bindip.value;
  var regIP=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
  var IP_flag=false;
  if(regIP.test(myip)){
	IP_flag = true;
	}else{
	IP_flag = false;
	}
	if (!IP_flag){
	  alert("对不起，ip地址格式错误！");
		listform.bindip.focus();
		listform.bindip.select();
	  return false;
	}
	listform.actiontype.value="5";
	listform.submit();
}

function  changepassfun() {
	if(listform.logname.value==""  ){
		alert("该用户无法修改密码！");
		return ;
	} 	
	if(listform.pass.value=="" || listform.repass.value==""){
		alert("密码不能为空!");
		listform.pass.focus();
		listform.pass.select();
		return;
	}
	if(listform.pass.value!=listform.repass.value){
		alert("密码不一致!");
		return;
	}
	var mypass=listform.pass.value;
	for(var i=0;i<mypass.length;i++)
     {
       var myChar= mypass.toLowerCase().charAt(i);
       var myLenth=mypass.replace(/[^\x00-\xff]/g,'**').length;	
       if((!(myChar>='0' && myChar<='9')) && (!(myChar>='a' && myChar<='z')))
       { 
			  alert("对不起，密码不安全！");
				listform.pass.focus();
				listform.pass.select();
      	return;
       }
       else if((myLenth>=0)&&(myLenth<8))
       { 
			  alert("对不起，密码不安全！");
				listform.pass.focus();
				listform.pass.select();
      	return;
       }
     }
	var Pass_flag=false;
	var reg=/^(?=.*[0-9].*)(?=.*[a-zA-Z].*).{8,}$/;
	if(reg.test(mypass)){
		Pass_flag = true;
		}else{
		Pass_flag = false;
		}
		if (!Pass_flag){
		  alert("对不起，密码不安全！");
			listform.pass.focus();
			listform.pass.select();
		  return false;
		}
	listform.actiontype.value="4";
	listform.submit();
}
</SCRIPT>
<style type="text/css">
<!--
.hand {  cursor: hand}
.unnamed1 {  width: 160px}
-->
</style>
</head>

<body bgcolor="#F0F0F0" text="#000000" oncontextmenu="return false" topmargin="0" leftmargin="0" >

  <form name="listform" action="/icm/main.xp" method="POST">
  <table width="90%" border="0" cellspacing="0" cellpadding="2" align="center">
    <tr> 
      <td> 
        <div align="right">
					
					<input type="button" onclick="addlistfun();"  value="添加用户"  class=input size=10  > 
          <input type="button" onclick="changepassfun();"  value="修改密码"  class=input size=10  > 
          <input type="button" onclick="updatelistfun();"  value="修改权限"  class=input size=10  > 
          <input type="button" onclick="updateipfun();"  value="修改IP"  class=input size=10  >
          <input type="button" onclick="dellistfun();"  value="删除用户"  class=input size=10  > 
          <input type="hidden" name="Fun" value="icmAdminAction" >
          <input type="hidden" name="actiontype" value="1" >
        </div>
      </td>
    </tr>
  </table>
  <table width="90%" border="1" cellspacing="0" cellpadding="0" align="center" bordercolor="#666666" style="BORDER-COLLAPSE: collapse" bgcolor="#F0f0f0">
    <tr>
      <td>
        <table border="0" align="center" cellpadding="3" cellspacing="0" width="100%">
          <tr> 
            <td colspan="3" > 
              <table width="100%" border="0" cellspacing="0" cellpadding="4">
                <tr> 
                  <td width="20%">用户名 </td>
                  <td width="88%" colspan="2"> 
                    <input type="text" name="logname" size="20" maxlength="20" value="[$logname$]"  class=input  >
                  </td>
                </tr>
                <tr> 
                  <td width="20%">密码及确认</td>
                  <td width="38%"> 
                    <input type="password" name="pass" size="20" maxlength="18"  class=input  >
                  </td>
                  <td width="50%">
                    <input type="password" name="repass" size="20" maxlength="18"  class=input  >
                  </td>
                </tr>
                <tr> 
                  <td width="20%">IP地址 </td>
                  <td width="88%" colspan="2"> 
                    <input type="text" name="bindip" size="20" maxlength="20" value="[$bindip$]"  class=input  >
                  </td>
                </tr> 
                <tr> 
                  <td width="20%">权限：</td>
                  <td width="88%" colspan="2"> 
                    <input type="checkbox" name="chr1" value="1" [$chsel1$]>
                    实时状态&nbsp;&nbsp; 
                    <input type="checkbox" name="chr2" value="2" [$chsel2$]>
                    数据中心&nbsp;&nbsp; 
                    <input type="checkbox" name="chr3" value="3" [$chsel3$] >
                    报表中心&nbsp;&nbsp; 
                    <input type="checkbox" name="chr4" value="4" [$chsel4$]>
                    管理中心&nbsp;&nbsp; 
                </tr>
               
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <br>
  <table width="90%" border="1" cellspacing="0" cellpadding="3" align="center" bordercolor="#999999" style="BORDER-COLLAPSE: collapse">
    <tr > 
      <td width="32"  height="20" background="/images/barbg.gif">&nbsp;</td>
      <td width="250"  height="20" valign="bottom" background="/images/barbg.gif">&nbsp;管理员名称 
      </td>
      <td width="350"  height="20" valign="bottom" background="/images/barbg.gif">&nbsp;最后一次访问时间 
      </td>
    </tr>
    [$begintable list$] 
    <tr onClick="xxxxfun('[$logname$]');" bgcolor="#F3F3F3" > 
      <td width="32" > 
        <div align="center"> 
          <input type="checkbox" name="chk[$num$]" value="[$num$]">
        </div>
      </td>
      <td width="250" >&nbsp;[$logname$]</td>
      <td width="350" >&nbsp;[$lasttime$]</td>
    </tr>
    [$endtable$] 
  </table>
</form>      



</body>
</html>
