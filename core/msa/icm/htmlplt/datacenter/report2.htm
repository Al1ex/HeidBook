<HTML><HEAD><TITLE>网络7层管理和过滤的领导者</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK rel=stylesheet type=text/css href="/icm/publiccss/pubcss.css">
<LINK rel=stylesheet type=text/css href="/icm/extjs/resources/css/ext-all.css">
<link rel="stylesheet" type="text/css" href="/icm/extjs/resources/css/feed-viewer.css" />
<LINK rel=stylesheet type=text/css href="/icm/extjs/resources/css/xtheme-default.css" id="xthemecss" >
<script type="text/javascript" src="/icm/extjs/adapter/ext/ext-base.js"></script>
<SCRIPT type=text/javascript  src="/icm/extjs/ext-all.js"></SCRIPT>
<script type=text/javascript  src="/icm/publicjs/select_time_st_1.js"></script>
<script type=text/javascript  src="/icm/publicjs/exportexcel.js"></script>

<style type="text/css">
.settings {  
	BACKGROUND-IMAGE: url(/icm/extjs/shared/icons/fam/folder_wrench.png)
}
.nav {
	BACKGROUND-IMAGE: url(/icm/extjs/shared/icons/fam/folder_go.png)
}
</style>
<script type="text/javascript">
  Ext.BLANK_IMAGE_URL = '/icm/extjs/resources/images/default/s.gif';
  var xtzystore;
  pagesize=100;
  
  function checkip(){
    var pattern=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
    var flag_ip=pattern.test(ip.value);
    if(!flag_ip){  
         Ext.Msg.alert("提示","您输入的IP格式不正确，请重新输入!"); 
         return false;
     }else{
     xtzystore.baseParams={Fun:'icmArpListSearch',ip:ip.value,mac:mac.value};
		 xtzystore.load({params:{Fun:'icmArpListSearch',ip:ip.value,mac:mac.value,start:0,limit:pagesize}});
     Ext.Msg.alert("提示","查询成功！");
     	}
   }
   
   function checkMac(){ 
    //mac地址正则表达式 
     var reg_name=/[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}/; 
     if(!reg_name.test(mac.value)){ 
       Ext.Msg.alert("提示","MAC地址格式不正确！MAC地址格式为00-24-21-19-BD-E4，请重新输入!"); 
       return false;
     }else{ 
     xtzystore.baseParams={Fun:'icmArpListSearch',ip:ip.value,mac:mac.value};
		 xtzystore.load({params:{Fun:'icmArpListSearch',ip:ip.value,mac:mac.value,start:0,limit:pagesize}});
     Ext.Msg.alert("提示","查询成功！");
     }
   }



  
	function find(){
		    if(ip.value=='' && mac.value==''){
		    	Ext.Msg.alert("提示","请输入查询条件!");
		    }
		    else if(ip.value!='' && mac.value=='')
		    {
		    	var pattern=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
    			var flag_ip=pattern.test(ip.value);
    			if(!flag_ip)
    			{  
         			Ext.Msg.alert("提示","您输入的IP格式不正确，请重新输入!"); 
         			return false;
     			}
			   xtzystore.load({params:{Fun:'icmArpListSearch',ip:ip.value,mac:mac.value,start:0,limit:pagesize}});
		    }
		    else if(ip.value=='' && mac.value!='')
		    {
		    	var reg_name=/[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}/; 
          if(!reg_name.test(mac.value))
          { 
              Ext.Msg.alert("提示","MAC地址格式不正确！MAC地址格式为00-24-21-19-BD-E4，请重新输入!"); 
              return false;
          }
			   xtzystore.load({params:{Fun:'icmArpListSearch',ip:ip.value,mac:mac.value,start:0,limit:pagesize}});
		    }
	      else if(ip.value!='' && mac.value!='')
	      {
          var pattern=/^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/;
    			var flag_ip=pattern.test(ip.value);
    			if(!flag_ip)
    			{  
         			Ext.Msg.alert("提示","您输入的IP格式不正确，请重新输入!"); 
         			return false;
     			}
	      	var reg_name=/[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}-[A-F\d]{2}/; 
          if(!reg_name.test(mac.value))
          { 
              Ext.Msg.alert("提示","MAC地址格式不正确！MAC地址格式为00-24-21-19-BD-E4，请重新输入!"); 
              return false;
          }
			   xtzystore.load({params:{Fun:'icmArpListSearch',ip:ip.value,mac:mac.value,start:0,limit:pagesize}});
	     }
	   }
  xtzystore = new Ext.data.JsonStore({
        root: 'Results',
        totalProperty: 'totalCount',
        url:'/icm/main.xp',
				baseParams:{Fun:'icmArpListSearch',reporttype:'1'},
        fields: [
        {name: 'ipadd'},
        {name: 'mac'},
				{name: 'requestnum'},
        {name: 'lastrequesttime'},
        {name: 'flag'}]
    });
    
  function pctChange(val){

        if(val == 0){

            return '系统不允许使用该ip';

        }else if(val == 1){

            return '没有绑定MAC或者MAC绑定不正确';

        }else if(val == 2){

            return '超过允许使用期限';

        }else if(val == 3){

            return '被系统锁定使用';

        }else if(val == 4){

            return 'DHCP分组设置错误';

        }else{

            return '其他未知错误';

        }

        return val;

    }

	
	Ext.onReady(function(){
	   Ext.QuickTips.init();
     var detailEl;
     var win;
	 	 var myMask = new Ext.LoadMask(Ext.getBody(), {msg:"Please wait..."});
		 myMask.show();
		 HlPagingToolbar = Ext.extend(Ext.PagingToolbar, { 
    		displayInfo: true, 
    		displayMsg: '显示第 {0} 条到 {1} 条报告，共 {2} 条', 
    		emptyMsg: "无记录", 
    		initComponent : function(){ 
    		var pageSizeItems = [ 
                     '-','每页', 
                     this.inputItem = new Ext.form.NumberField({ 
                     cls: 'x-tbar-page-number', 
                     allowDecimals: false, 
                     allowNegative: false, 
                     enableKeyEvents: true,
                     maxValue: 500, 
                     maxText: '每页不允许超过500条', 
                     selectOnFocus: true, 
                     value: this.pageSize, 
                     submitValue: false, 
                     listeners: { 
                        scope: this, 
                        keydown: this.onHlPagingKeyDown, 
                        blur: this.onHlPagingBlur 
                        } 
                     }),'条','-',{
                        icon: '/icm/images/grid.png',
                        enableToggle:true,
                        text: '导出报表到Excel',
                        cls: 'x-btn-text-icon details',
                        toggleHandler: function(btn, pressed){
                        downloadViewDataActive(xtzygrid);
                        }
                     },'-']; 
        var userItems = this.items || []; 
        this.items = userItems.concat(pageSizeItems); 
        HlPagingToolbar.superclass.initComponent.call(this);
        }, 
			  onHlPagingKeyDown: function(field, e){ 
					         if(field.isValid()){ 
					            var k = e.getKey(); 
					             if(k == e.RETURN) { 
					                e.stopEvent(); 
					                this.pageSize = field.getValue(); 
					                pagesize=this.pageSize;
					                this.doRefresh(); 
					             } 
					        } 
				 }, 
				onHlPagingBlur: function(field){ 
					        if(field.isValid()){ 
					            this.pageSize = field.getValue(); 
					            pagesize=this.pageSize;
					            this.doRefresh(); 
					        } 
					    } 
		 });
		 var pagingBar= new HlPagingToolbar({
        store: xtzystore,
        pageSize: pagesize,
        displayInfo: true}); 
		 var xtzygrid = new Ext.grid.GridPanel({
        store:xtzystore, 
        bbar: new Ext.StatusBar({
                      id: 'centerstatus',
                      defaultText: 'Ready',
                      defaultIconCls: 'default-icon',
                      iconCls: 'ready-icon'
        }),
		    viewConfig:{forceFit: true, scrollOffset: 0},
        columns: [
            {header: "上线IP", width: 120, sortable: true, dataIndex: 'ipadd'},
            {header: "上线MAC",   width: 120, sortable: true,  dataIndex: 'mac'},
            {header: "发送请求次数",  width: 120, sortable: true,  dataIndex: 'requestnum'},
            {header: "最后请求的时间",  width: 120, sortable: true,  dataIndex: 'lastrequesttime'},
            {id:'flag',header: "拒绝原因",  width: 130, sortable: true, renderer: pctChange,  dataIndex: 'flag'}

        ],
        tbar: pagingBar,
        stripeRows: true,
        autoExpandColumn: 'flag',
        height:screen.height-150,
        title:'已生成ARP报警列表',
        frame:true,
        collapsible:true,
        loadMask:{msg:'正在加载数据，请稍侯……'},
        draggable:true

     });  

	var northPanelTop = new Ext.Panel({
    frame:true,
    region:'north',
    title: 'ARP报警列表查询条件',
    collapsible:true,
    contentEl:'north'
  });
    
  var mainPanel={
      id: 'main-panel',
      region:'center',
      collapsible: true,
      split:true,
      width: 135,
      minSize: 125,
      maxSize: 400,
      layout:'fit',
      margins:'0 5 0 0',
      items:[xtzygrid]
  };
	new Ext.Viewport({
		layout: 'border',
		items: [northPanelTop,mainPanel],
		renderTo: Ext.getBody()
	});
	myMask.hide();
});
	

</script>
</head>
</head>
<body>
<DIV style="DISPLAY: none">
<DIV id=north>
        <input type="hidden" class=inputf0  id="stime" name="stime" maxlength="24" value="">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" >
  <tr> 
    <td> 
         <table width="100%" border="0" cellpadding="0" cellspacing="0">
				<tr>
				    <td width="50">  &nbsp;</td>
				     <td>  &nbsp;</td>
				  </tr>
				<tr>
				     <td width="50">  &nbsp;</td>
				    <td>提示：根据您所选择的条件进行查询，查询后系统将列出此范围的记录</td>
				  </tr>
        <table border="0" cellspacing="0" cellpadding="0"  align="left" valign="top" >
          <div id="plabel"  align="left"> 
            <tr valign="top" > 
              <td width="50" > 
                <div align="center">&nbsp;</div>
              </td>
              <td  height="20"  align="left" valign="top" >
              	<input type="hidden" name="Fun" value="nassrvreportproc">
                <input type="hidden" id="ptype" name="ptype" values="0">
                &nbsp;&nbsp;&nbsp;IP地址：
                <input type="text" id="ip" class=inputf0  size="20" maxlength="32" values="">
             </td>
             </tr> 
             
             <tr valign="top" > 
              <td width="50" > 
                <div align="center">&nbsp;</div>
              </td>
              <td  height="20"  align="left" valign="top" > 
                <input type="hidden" name="Fun" value="nassrvreportproc">
                <input type="hidden" id="ptype" name="ptype" values="0">
                MAC地址：
                <input type="text" id="mac" class=inputf0 size="20" maxlength="32" values="" >
             </td>
             </tr>         	
             <tr> 
              <td height="50">&nbsp; </td>
              <td height="20">
                <input type="button"   class=inputf0 border="0" value="开始查询" onClick="find();" >  
              </td>
            </tr>
          </div>
        </table>
      
    </td>
  </tr>

</table>

 </div>

</div>
</body>

</html>

 

